# Задание №8

## Варианты 2. Задача о назначении. Венгерский алгоритм
Для выполнения задания необходимо: 
1. Решить задачу о назначении с использованием Венгерского алгоритма **строго** так, как было разобрано на занятиях.
2. Оформить решение задачи по шагам с подробными комментариями, таблицами и диаграммами.
3. В ответе указать минимальную сумму затрат на выполнение всех заданий.
4. В ответе вывести найденные назначения


### Решение
Дана матрица затрат для задач A, B, C, D, E и исполнителей 1, 2, 3, 4, 5:
|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  17   |  18   |  11   |  16   |  11   |
| **B** |  13   |   5   |  18   |  20   |  10   |
| **C** |  14   |   5   |   9   |  12   |  20   |
| **D** |  15   |   7   |  14   |   8   |  16   |
| **E** |  19   |  19   |  14   |  10   |  14   |

1. Проведем редукцию матрицы затрат по строкам. Вычтем из каждой строки минимальное значение, представленное в этой строке.

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  6   |  7   |  0   |  5   |  0   |
| **B** |  8   |   0   |  13   |  15   |  5   |
| **C** |  9   |   0   |   4   |  7   |  15   |
| **D** |  8   |   0   |  7   |   1   |  9   |
| **E** |  9   |  9   |  4   |  0   |  4   |

2. После чего проведем редукцию матрицы затрат по столбцам. Вычтем из каждого столбца минимальное значение, представленное в этом столбце.

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  7   |  0   |  5   |  0   |
| **B** |  2   |   0   |  13   |  15   |  5   |
| **C** |  3   |   0   |   4   |  7   |  15   |
| **D** |  2   |   0   |  7   |   1   |  9   |
| **E** |  3   |  9   |  4   |  0   |  4   |

Получим редуцированную матрицу, где нули обозначают наименее затратные варианты назначений.



3. Построим двудольный граф, вынесем на него те ребра, для которых в редуцированной матрице указаны нули.


```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A --- 1
    A --- 3
    A --- 5
    B --- 2
    C --- 2
    D --- 2
    E --- 4
```
Выберем произвольное паросочетание $[A, 1]$, $[B, 2]$, $[E, 4]$ и попытаемся построить совершенное паросочетание с помощью чередующихся деревьев.


```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A === 1
    A --- 3
    A --- 5
    B === 2
    C --- 2
    D --- 2
    E === 4

    style A fill:#008000
    style B fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 4 fill:#008000
```

Попытаемся построить дерево из оставшейся непокрытой вершины C.

```mermaid
graph LR
    subgraph " 0 фр."
        C((C))
    end
    subgraph " 1 фр."
        2((2))
    end
    subgraph " 2 фр."
        B((B))
    end
    C ---> 2 ===> B
    
    style B fill:#008000
    style 2 fill:#008000
```
Во множество X выпишем все **покрытые построенным деревом** вершины первой доли графа, во множество Y все **покрытые построенным деревом** вершины из второй доли графа.
$$
X = \{B, C\}
$$

$$
Y = \{2 \}
$$

Необходимо найти минимальный элемент из строк, включенных во множество X и столбцов, не включенных во множество Y. В нашем случае это будут строки B, C и столбцы 1, 3, 4, 5. Минимальный элемент 2, расположен в строке B и столбце 1. 

Вычтем найденное значение из строк множества X и прибавим к столбцам множества Y:

Редуцируем строки B, C

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  7   |  0   |  5   |  0   |
| **B** |  0   |   -2   |  11   |  13   |  3   |
| **C** |  1   |   -2   |   2   |  5   |  13   |
| **D** |  2   |   0   |  7   |   1   |  9   |
| **E** |  3   |  9   |  4   |  0   |  4   |

восстанавливаем столбец 2

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  9   |  0   |  5   |  0   |
| **B** |  0   |   0   |  11   |  13   |  3   |
| **C** |  1   |   0   |   2   |  5   |  13   |
| **D** |  2   |   2   |  7   |   1   |  9   |
| **E** |  3   |  11   |  4   |  0   |  4   |

Получаем новое ребро B -> 1 и теряем ребро D -> 2

Редуцируем строку D и получим:

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  9   |  0   |  5   |  0   |
| **B** |  0   |   0   |  11   |  13   |  3   |
| **C** |  1   |   0   |   2   |  5   |  13   |
| **D** |  1   |   1   |  6   |   0   |  8   |
| **E** |  3   |  11   |  4   |  0   |  4   |

Получаем новое ребро D -> 4

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A === 1
    A --- 3
    A --- 5
    B === 2
    C --- 2
    D --- 4
    E === 4
    B --- 1

    style A fill:#008000
    style B fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 4 fill:#008000
```

Попытаемся построить совершенное паросочетание с помощью чередующихся деревьев.

```mermaid
graph LR
    subgraph " 0 фр."
        C((C))
    end
    subgraph " 1 фр."
        2((2))
    end
    subgraph " 2 фр."
        B((B))
    end
    subgraph " 3 фр."
        1((1))
    end
    subgraph " 4 фр."
        A((A))
    end
    subgraph " 5 фр."
        5((5))
    end
    C --> 2 ==> B
    B --> 1 ==> A
    A --> 5 
    style A fill:#008000
    style B fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
```

Построенное дерево содержит чередующуюся, относительно текущего паросочетания, цепь С2 - 2B - B1 - 1A - A5, цепь начинается и заканчивается в непокрытых вершинах, все ребра в цепи чередуются по вхождению в текущее паросочетание.

"Перекрасим" найденную цепь и проверим полученное паросочетание.

```mermaid
graph LR
    subgraph " 0 фр."
        C((C))
    end
    subgraph " 1 фр."
        2((2))
    end
    subgraph " 2 фр."
        B((B))
    end
    subgraph " 3 фр."
        1((1))
    end
    subgraph " 4 фр."
        A((A))
    end
    subgraph " 5 фр."
        5((5))
    end
    C ==> 2 --> B
    B ==> 1 --> A
    A ==> 5 
    style A fill:#008000
    style B fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000

    style C fill:#008000
    style 5 fill:#008000
```

И получаем новый граф

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A --- 1
    A --- 3
    A === 5
    B --- 2
    C === 2
    D --- 4
    E === 4
    B === 1

    style A fill:#008000
    style B fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 4 fill:#008000
    style C fill:#008000
    style 5 fill:#008000
```

Попытаемся построить совершенное паросочетание с помощью чередующихся деревьев.

```mermaid
graph LR
    subgraph " 0 фр."
        D((D))
    end
    subgraph " 1 фр."
        4((4))
    end
    subgraph " 2 фр."
        E((E))
    end
    D ---> 4 ===> E
    
    style E fill:#008000
    style 4 fill:#008000
```


В построенном дереве нет цепей, чередующееся относительно текущего паросочетания, ветка закончилась в покрытой вершине, то есть в указанном графе нет совершенного паросочетания.

Проведем повторную редукцию матрицы затрат.

Во множество X выпишем все **покрытые построенным деревом** вершины первой доли графа, во множество Y все **покрытые построенным деревом** вершины из второй доли графа.

$$
X = \{D, E\}
$$

$$
Y = \{4 \}
$$

Необходимо найти минимальный элемент из строк, включенных во множество X и столбцов, не включенных во множество Y. В нашем случае это будут строки D, E и столбцы 1, 2, 3, 5. Минимальный элемент 1, расположен в строке D и столбце 1. 

Было:

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  9   |  0   |  5   |  0   |
| **B** |  0   |   0   |  11   |  13   |  3   |
| **C** |  1   |   0   |   2   |  5   |  13   |
| **D** |  1   |   1   |  6   |   0   |  8   |
| **E** |  3   |  11   |  4   |  0   |  4   |

Вычтем найденное значение из строк множества X и получим: 

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  9   |  0   |  5   |  0   |
| **B** |  0   |   0   |  11   |  13   |  3   |
| **C** |  1   |   0   |   2   |  5   |  13   |
| **D** |  0   |   0   |  5   |   -1   |  7   |
| **E** |  2   |  10   |  3   |  -1   |  3   |

Прибавим найденное значение к столбцам множества Y и получим: 

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  9   |  0   |  6   |  0   |
| **B** |  0   |   0   |  11   |  14   |  3   |
| **C** |  1   |   0   |   2   |  6   |  13   |
| **D** |  0   |   0   |  5   |   0   |  7   |
| **E** |  2   |  10   |  3   |  0   |  3   |

Получаем 2 новых ребра D -> 1 и D -> 2

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A --- 1
    A --- 3
    A === 5
    B --- 2
    C === 2
    D --- 4
    E === 4
    B === 1
    D --- 1
    D --- 2

    style A fill:#008000
    style B fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 4 fill:#008000
    style C fill:#008000
    style 5 fill:#008000
```

Попытаемся построить совершенное паросочетание с помощью чередующихся деревьев.

```mermaid
graph LR
    subgraph " 0 фр."
        D((D))
    end
    subgraph " 1 фр."
        1((1))
        2((2))
        4((4))
    end
    subgraph " 2 фр."
        B((B))
        C((C))
        E((E))
    end

    D --- 1 === B
    D --- 2 === C
    D --- 4 === E


    style E fill:#008000
    style B fill:#008000
    style 4 fill:#008000
    style 2 fill:#008000
    style 1 fill:#008000
    style C fill:#008000
```

В построенном дереве нет цепей, чередующееся относительно текущего паросочетания, так как ветки закончились в покрытых вершинах, то есть в указанном графе нет совершенного паросочетания.

Проведем повторную редукцию матрицы затрат.

Во множество X выпишем все **покрытые построенным деревом** вершины первой доли графа, во множество Y все **покрытые построенным деревом** вершины из второй доли графа.

$$
X = \{B, C, E, D\}
$$

$$
Y = \{1, 2, 4\}
$$


Необходимо найти минимальный элемент из строк, включенных во множество X и столбцов, не включенных во множество Y. В нашем случае это будут строки B, C, E, D и столбцы 3, 5. Минимальный элемент 2, расположен в строке C и столбце 3. 

Было:

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  9   |  0   |  6   |  0   |
| **B** |  0   |   0   |  11   |  14   |  3   |
| **C** |  1   |   0   |   2   |  6   |  13   |
| **D** |  0   |   0   |  5   |   0   |  7   |
| **E** |  2   |  10   |  3   |  0   |  3   |


Вычтем найденное значение из строк множества X и получим: 

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  0   |  9   |  0   |  6   |  0   |
| **B** |  -2   |   -2   |  9   |  12   |  1   |
| **C** |  -1   |   -2   |   0   |  4   |  11   |
| **D** |  -2   |   -2   |  3   |   -2   |  5   |
| **E** |  0   |  8   |  1   |  -2   |  1   |

Прибавим найденное значение к столбцам множества Y и получим: 

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** |  2   |  11   |  0   |  8   |  0   |
| **B** |  0   |   0   |  9   |  14   |  1   |
| **C** |  1   |   0   |   0   |  6   |  11   |
| **D** |  0   |   0   |  3   |   0   |  5   |
| **E** |  2   |  10   |  1   |  0   |  1   |

Теряем ребро A -> 1 и получаем новое ребро C -> 3

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A --- 3
    A === 5
    B --- 2
    C === 2
    D --- 4
    E === 4
    B === 1
    D --- 1
    D --- 2
    C --- 3

    style A fill:#008000
    style B fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 4 fill:#008000
    style C fill:#008000
    style 5 fill:#008000
```

Попытаемся построить совершенное паросочетание с помощью чередующихся деревьев.

```mermaid
graph LR
    subgraph " 0 фр."
        D((D))
    end
    subgraph " 1 фр."
        1((1))
        2((2))
        4((4))
    end
    subgraph " 2 фр."
        B((B))
        C((C))
        E((E))
    end
    subgraph " 3 фр."
        3((3))
    end
    D --- 1 === B
    D --- 2 === C --- 3
    D --- 4 === E

    style B fill:#008000
    style 1 fill:#008000
    style E fill:#008000
    style 4 fill:#008000
    style 2 fill:#008000
    style C fill:#008000
```

Построенное дерево содержит чередующуюся, относительно текущего паросочетания, цепь D2 - 2C - C3, цепь начинается и заканчивается в непокрытых вершинах, все ребра в цепи чередуются по вхождению в текущее паросочетание.

"Перекрасим" найденную цепь и проверим полученное паросочетание.

```mermaid
graph LR
    subgraph " 0 фр."
        D((D))
    end
    subgraph " 1 фр."
        1((1))
        2((2))
        4((4))
    end
    subgraph " 2 фр."
        B((B))
        C((C))
        E((E))
    end
    subgraph " 3 фр."
        3((3))
    end
    D --- 1 === B
    D === 2 --- C === 3
    D --- 4 === E

    style B fill:#008000
    style 1 fill:#008000
    style D fill:#008000
    style 3 fill:#008000
    style E fill:#008000
    style 4 fill:#008000
    style 2 fill:#008000
    style C fill:#008000
```

Тем самым количество пар в паросочетании увеличилось

Итоговый граф:

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A --- 3
    A === 5
    B --- 2
    C --- 2
    D --- 4
    E === 4
    B === 1
    D --- 1
    D === 2
    C === 3
    
    style D fill:#008000
    style 3 fill:#008000
    style A fill:#008000
    style B fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 4 fill:#008000
    style C fill:#008000
    style 5 fill:#008000
```

Итоговое паросочетание: 

```mermaid
graph LR
    subgraph "Доля 1"
        A((A))
        B((B))
        C((C))
        D((D))
        E((E))
    end
    subgraph "Доля 2"
        1((1))
        2((2))
        3((3))
        4((4))
        5((5))
    end
    A === 5
    D === 2
    E === 4
    B === 1
    C === 3
    
    style D fill:#008000
    style 3 fill:#008000
    style A fill:#008000
    style B fill:#008000
    style E fill:#008000
    style 1 fill:#008000
    style 2 fill:#008000
    style 4 fill:#008000
    style C fill:#008000
    style 5 fill:#008000
```
Полученное расписание является совершенным. Выпишем полученные назначения и их стоимости из исходной матрицы:
- B1 - 13
- D2 - 7
- C3 - 9
- E4 - 10
- A5 - 11

Общая стоимость затрат = 13 + 11 + 7 + 10 + 9 = 50

## Ответ
Минимальная стоимость затрат 50, при следующих назначениях:
- задача B, исполнитель 1,
- задача D, исполнитель 2,
- задача C, исполнитель 3,
- задача E, исполнитель 4.
- задача A, исполнитель 5.