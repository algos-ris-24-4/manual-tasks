# Задание №12
# Задача о рюкзаке. Метод ветвей и границ. Вариант №4

Для каждого варианта представлены условия задачи, в соответствии с которыми необходимо: 
1. Решить задачу о рюкзаке с применением метода ветвей и границ.
2. Оформить решение задачи по шагам с подробными комментариями, таблицами и диаграммами.
3. **В узлах построенного дерева привести расчет оценки и указать порядковый номер, по которым можно проверить порядок исследования узлов дерева**, либо оформить решение с пошаговым построением дерева (как в примере ниже).
4. В ответе указать:
   - максимально возможную стоимость предметов в рюкзаке,
   - набор предметов, обеспечивающих максимальную стоимость,
   - общий вес предметов в рюкзаке,
   - свободное место в рюкзаке.


## Постановка задачи
Задача о рюкзаке (англ. Knapsack problem) — дано N предметов, n<sub>i</sub> предмет имеет массу w<sub>i</sub> > 0 и стоимость p<sub>i</sub> > 0. Необходимо выбрать из этих предметов такой набор, чтобы суммарная масса не превосходила заданной величины W (вместимость рюкзака), а суммарная стоимость была максимальна. 

## Условия задачи
|    **Предметы**   | **A** | **B** | **C** | **D** | **E** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   3   |   5   |   8   |   6   |   8   |
| **Вес**           |   12  |  10   |   4   |   2   |   2   |

Ограничение вместимости - 16

## Шаг 1
Сортируем предметы по их ценности $(\frac {Стоимость}{вес})$

|    **Предметы**   | **E** | **D** | **C** | **B** | **A** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   8   |   6   |   8   |   5   |   3   |
| **Вес**           |   2   |   2   |   4   |   10  |   12  |
| **Ценность**      |   4   |   3   |   2   |$\frac{1}{2}$|$\frac{1}{4}$|

## Шаг 2
Представим, что самого ценного предмета из тех, что еще не обработаны, у нас бесконечное количество и мы можем делить его на сколь угодно малые части. Тогда мы можем все оставшееся в рюкзаке место заполнить этим предметом. Тогда ценность будет

$$
16 * 4 = 64
$$

Это значение будет корнем нашего дерева, оно представляет оценку перспективности для задачи в целом.

## Шаг 3
Разобьем множество решений на два подмножества и начнем строить дерево. Левым потомком будет подмножество решений, в которых мы взяли самый ценный из оставшихся предметов, правым - где не взяли. 

Оценка перспективности левого потомка:

$$
8 + (16 - 2) * 3 = 50
$$

Оценка перспективности правого потомка:

$$
16 * 3 = 48
$$


``` mermaid
flowchart TD
A(64)
B(50)
C(48)
A -- +E--> B
A -- -E--> C

style B fill:#4f4f
```

Повторяем шаг 3 и продолжаем строить дерево из самой перспективной вершины.

Оценка перспективности левого потомка:

$$
8 + 6 + (16 - 2 - 2) * 2 = 14 + 12 * 2 = 38
$$

Оценка перспективности правого потомка:

$$
8 + (16 - 2) * 2 = 36
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E

style C fill:#4f4f
```

Самая перспективная вершина оказалась на другой ветке. Продолжаем строить из вершины с оценкой 48.

Оценка перспективности левого потомка:

$$
6 + (16 - 2) * 2 = 6 + 14 * 2 = 34
$$

Оценка перспективности правого потомка:

$$
16 * 2 = 32
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
F(34)
G(32)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- +D--> G

style D fill:#4f4f
```

Самая перспективная вершина - 38.

Оценка перспективности левого потомка:

$$
8 + 6 + 8 + (16 - 2 - 2 - 4) * \frac{1}{2} = 22 + 8 * \frac{1}{2} = 26 
$$

Оценка перспективности правого потомка:

$$
8 + 6 + 12 * \frac{1}{2} = 20
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
F(34)
G(32)
H(26)
I(20)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I

style E fill:#4f4f
```

Самая перспективная вершина - 36.

Оценка перспективности левого потомка:

$$
8 + 8 + (14 - 4) * \frac{1}{2} = 16 + 10 * \frac{1}{2} = 21
$$

Оценка перспективности правого потомка:

$$
8 + 14 * \frac{1}{2} = 15
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
F(34)
G(32)
H(26)
I(20)
J(21)
K(15)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K

style F fill:#4f4f
```

Самая перспективная вершина - 34.

Оценка перспективности левого потомка:

$$
6 + 8 + (14 - 4) * \frac{1}{2} = 14 + 10 * \frac{1}{2} = 19
$$

Оценка перспективности правого потомка:

$$
6 + 14 * \frac{1}{2} = 13
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
F(34)
G(32)
H(26)
I(20)
J(21)
K(15)
L(19)
M(13)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K
F -- +C--> L
F -- -C--> M

style G fill:#4f4f
```

Самая перспективная вершина - 32.

Оценка перспективности левого потомка:

$$
8 + (16 - 4) * \frac{1}{2} = 8 + 12 * \frac{1}{2} = 14
$$

Оценка перспективности правого потомка:

$$
16 * \frac{1}{2} = 8
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
F(34)
G(32)
H(26)
I(20)
J(21)
K(15)
L(19)
M(13)
N(14)
O(8)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K
F -- +C--> L
F -- -C--> M
G -- +C--> N
G -- -C--> O

style H fill:#4f4f
```

Самая перспективная вершина - 26.

Оценка перспективности левого потомка:

$$
8 + 6 + 8 + 8 + 5 + (16 - 2 - 2 - 4 - 10) * \frac{1}{4} = 28 + (-8) * \frac{1}{4} 
$$

Получили отрицательное значение - значит этот предмет не поместится в рюкзак. Поэтому от этой вершины мы не будем продолжать поиск.

Оценка перспективности правого потомка:

$$
8 + 6 + 8 + 8 * \frac{1}{4} = 24
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
F(34)
G(32)
H(26)
I(20)
J(21)
K(15)
L(19)
M(13)
N(14)
O(8)
P(X)
Q(24)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K
F -- +C--> L
F -- -C--> M
G -- +C--> N
G -- -C--> O
H -- +B--> P
H -- -B--> Q

style P fill:#FF0000
style Q fill:#4f4f
```

Самая перспективная вершина - 24.

Оценка перспективности левого потомка:

$$
8 + 6 + 8 + 8 + 5 + 3 + (16 - 2 - 2 - 4 - 10) * \frac{1}{4} = 31 + (-8) * \frac{1}{4}
$$

Снова получили отрицательное значение, поэтому не рассматриваем эту вершину

Оценка перспективности правого потомка: 
$$
8 + 6 + 8 + 8 * 0 = 22
$$

``` mermaid
flowchart TD
A(64)
B(50)
C(48)
D(38)
E(36)
F(34)
G(32)
H(26)
I(20)
J(21)
K(15)
L(19)
M(13)
N(14)
O(8)
P(X)
Q(24)
R(X)
S(22)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K
F -- +C--> L
F -- -C--> M
G -- +C--> N
G -- -C--> O
H -- +B--> P
H -- -B--> Q
Q -- +A--> R
Q -- -A--> S

style P fill:#FF0000
style R fill:#FF0000
style S fill:#4f4f
```

Поскольку мы опустились до самого нижнего уровня, рассмотрели все предметы, и вершина на самом нижнем уровне является самой перспективной, то это и будет ответом.
Чтобы восстановить все положенные в рюкзак предметы пройдемся по ребрам, которые привели нас к ответу.

## Ответ
В рюкзак пойдут предметы C, D и E. Максимальная стоимость рюкзака: 8 + 6 + 8 = 22. Общий вес предметов в рюкзаке: 4 + 2 + 2 = 8. Свободного места в рюкзаке: 16 - 8 = 8.
